<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Goblin's Shopper Tool</title>
<link rel="stylesheet" href="styles.css">
<style>
/* small local safety styling so it looks usable even if your css isn't loaded */
body { background: #000; color: #0f0; font-family: Consolas, Monaco, monospace; margin:0; padding:1rem; }
#tools { max-width:1000px; margin:0 auto 1rem; }
.terminal { width:90%; max-width:1000px; margin:1rem auto; padding:1rem; background:#000; border:2px solid #00FF00; min-height:160px; position:relative; overflow:auto; }
#ascii-container { white-space: pre; font-family: monospace; min-height:80px; }
#fake-input { white-space: pre; border-top:1px solid #0f0; padding-top:0.25rem; margin-top:0.5rem; color:#0f0; }
#ascii-title,#ascii-middle,#ascii-footer,#ascii-secret { white-space: pre; font-family: monospace; max-width:1000px; margin:0 auto 0.5rem; }
#ascii-secret { display:none; border:2px solid #00FF00; padding:0.75rem; max-height:420px; overflow:auto; background:#000; }
#output { width:100%; height:140px; background:#000; color:#0f0; border:2px solid #00FF00; padding:6px; }
button { margin-top:0.5rem; }
.small-note { font-size: 12px; color:#7f7; opacity:0.8; }
</style>
</head>
<body>

  <!-- ASCII Title (decoded from base64 via JS) -->
  <pre id="ascii-title" class="med-glow"></pre>

  <!-- Tools -->
  <div id="tools">
    <label for="shoplist">Select shoplist file:</label>
    <input type="file" id="shoplist"><br>
    <label for="max-price">Max price for buy command:</label>
    <input type="number" id="max-price" value="500"><br>
    <textarea id="output" readonly>Buy commands will appear here...</textarea><br>
    <button id="btnMake">Make List</button>
    <button id="btnCopy">Copy to Clipboard</button>
   <!-- <div class="small-note">Shoplist parser accepts pipe (`|`) fields. Fallback to `item,price` if pipes are missing.</div> -->
  </div>

  <!-- Middle ASCII -->
  <pre id="ascii-middle" class="high-glow"></pre>

  <!-- Terminal -->
  <div class="terminal" aria-live="polite">
    <div id="ascii-container"></div>
    <div id="fake-input" class="input-line"></div>
  </div>

  <!-- Footer ASCII -->
  <pre id="ascii-footer" class="ascii-footer"></pre>

  <!-- Hidden ASCII (appears on 'secret' command or F2) -->
  <pre id="ascii-secret"></pre>

<script>
/* --------------------------
   HELPERS & CONFIGURATION
   -------------------------- */

/**
 * decodeBase64ToText(base64Like)
 * Accepts either:
 *  - a string that starts with "data:...base64,AAAA..." OR
 *  - a plain base64 string.
 * Returns decoded text (UTF-8 presumed compatible with ASCII art).
 */
function decodeBase64ToText(b64) {
  if (!b64 || typeof b64 !== 'string') return '';
  // strip data:...base64, prefix if present
  const comma = b64.indexOf(',');
  if (b64.startsWith('data:') && comma !== -1) {
    b64 = b64.slice(comma + 1);
  }
  try {
    return atob(b64);
  } catch (err) {
    // if atob fails, return original (so it's easier to debug)
    console.warn('base64 decode failed', err);
    return '';
  }
}

/* safe append line to terminal output */
function printToTerminalLine(line) {
  const out = document.getElementById('ascii-container');
  // append with newline
  out.textContent += (out.textContent ? '\n' : '') + line;
  out.scrollTop = out.scrollHeight;
}

/* --------------------------
   Placeholders for your Base64 strings
   Replace the "PASTE_BASE64_HERE" strings with your real base64 text.
   They can be either:
     - "data:text/plain;base64,AAAA..." or
     - "AAAA..." (pure base64)
*/
   const asciiTitle = "ICBfX19fX19fXyAgICAgIF9fXy4gICAuX18gIC5fXyAgICAgL1wgICAgICAgICAgIF9fX19fX19fICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfXyAgICAgICAgICAgICAgICANCiAvICBfX19fXy8gIF9fX19cXyB8X18gfCAgfCB8X198IF9fXykvICBfX19fX18gIC8gIF9fX19fLyAgX19fXyAgIF9fX18gICBfX19fX19fX19fX19fX19fIF8vICB8XyAgX19fX19fX19fX18gDQovICAgXCAgX19fIC8gIF8gXHwgX18gXHwgIHwgfCAgfC8gICAgXCAvICBfX18vIC8gICBcICBfX19fLyBfXyBcIC8gICAgXF8vIF9fIFxfICBfXyBcX18gIFxcICAgX19cLyAgXyBcXyAgX18gXA0KXCAgICBcX1wgICggIDxfPiApIFxfXCBcICB8X3wgIHwgICB8ICBcXF9fXyBcICBcICAgIFxfXCAgXCAgX19fL3wgICB8ICBcICBfX18vfCAgfCBcLy8gX18gXHwgIHwgKCAgPF8+ICkgIHwgXC8NCiBcX19fX19fICAvXF9fX18vfF9fXyAgL19fX18vX198X19ffCAgL19fX18gID4gIFxfX19fX18gIC9cX19fICA+X19ffCAgL1xfX18gID5fX3wgIChfX19fICAvX198ICBcX19fXy98X198ICAgDQogICAgICAgIFwvICAgICAgICAgICBcLyAgICAgICAgICAgICBcLyAgICAgXC8gICAgICAgICAgXC8gICAgIFwvICAgICBcLyAgICAgXC8gICAgICAgICAgIFwvICAgICAgICAgICAgICAgICAgICA=";
   const asciiMiddle = "OjpJSTc3SUk9PT8/KysgID03N0lJSUlJSSAgICBJST8/Nzc3NyAgICAgNzc3NzdJNyAgSUk3Nzc3fn4gICs9PT8/PT0/PyAgIDc3Kz8sLA0KOjpJSTcgSUk9PT8/KysgID06OklJSUlJSSAgICBJSTc3Nzc3ICAgICAgIDc3Nzc3ST8gIElJNzc3N35+fiArPT0/Pz09Pz83IDc3Kz8sLA0KOisgIElJPT03Nzc3SUkgICA9PTc3SUk3NyAgICBJSTc3SUk/ICAgICAgIEk3Nzc3SUkgIElJSUk3ID8/ICBJSTdJSTc9PT8gIDcrPyx+DQo6PzcgOjorKzc3Nzc/PyAgICB+NyA/P0kgICAgIH5+Pz9JSSsgICAgICAgPT8/Pz8rKyAgP0lJNzc9PSAgID09Nzc3Nys/ICAgNzdJSTo6DQo6SSsrICA/Pzc3Nzc6fj0gICAgID06OiAgICAgICAgOj06ICAgICAgICAgICAgIDo6PSAgICA6Oj09OiAgID06fjc3Nzc/PyAgPT03NywsDQosSSs/UD09Nzc3Nz09PSAgICAgOjYgICAgICAgICAgIDYgICAgICAgICAgICAgICA2OiAgICB+PT1JSTc3PysgIH5+NzcsLCwNCiw3Pz80IH49NzdJST09ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgOj09SUk3Nz09ICArKyA3LCwNCiw3Pz9fXCA9PTc3SUk9PSwgICAgICAgfiBUaGUgR3JlZW5za2luIEZlZGVyYXRpb24gfiAgICAgIDo9PUlJNzc9PSAgICA/NywsDQosN0lJIMO7IDpJSUlJPT0gICAgICAgICB+IFRoZSBHb2JsaW4gQ29sbGVjdGl2ZSAgfiAgICAgICAufn43N0lJPT0gID09IDc6Og0KLEk/PyAgIDorKzc3PT0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA6On43NysrOjogID8/ICA6Og0KLDdJSSAgICAgIDcgPT0gICAgICAgRm9vbCB5b3UgdHdpY2UsIHNoYW1lIG9uIHlvdSAgICAgICA6Ojo3Nz09ICAgID8/Nzc6Og0KLDdJSX5+ICAgID8/fn4gICAgIEZvb2wgeW91IG9ubHkgdHdpY2UsIHNoYW1lIG9uIG1lICAgICAgfjpJSSAgICA9PSsrIDcsLA0KLklJSX5+fiAgICAgOn4gIE5ldmVyIHRyeSB0byBjcm9zcyB0aGUgRmVyZW5naSBBbGxpYW5jZSAgIDosLiAgICB+fj8/NzcsLg==";
   const asciiHidden = "ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLjo6Ojo6Oi4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA6KyolQEBAQEBAQEBAQEAlIystICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCSAgXG4gICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA6KyNAQEBAQEBAQEBAQEBAQEBAQEBAQEAlKy4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXG4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgID0lQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAJT0gICAgICAgICAgICAgICAgICAgICAgICAgICAgIFxuDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgK0BAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQCsgICAgICAgICAgICAgICAgICAgICAgICAgICBcbg0KICAgICAgICAgICAgICAgICAgICAgICAgICAtQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQC0gICAgICAgICAgICAgICAgICAgICAgICAgXG4NCiAgICAgICAgICAgICAgICAgICAgICAgICArQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAIyAgICAgICAgICAgICAgICAgICAgICAgIFxuDQogICAgICAgICAgICAgICAgICAgICAgICArQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEAlLiAgICAgICAgICAgICAgICAgICAgICBcbg0KICAgICAgICAgICAgICAgICAgICAgICA6QEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEAuICAgICAgICAgICAgICAgICAgICAgXG4NCiAgICAgICAgICAgICAgICAgICAgICAgKkBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAJSAgICAgICAgICAgICAgICAgICAgIFxuDQogICAgICAgICAgICAgICAgICAgICAgICpAQEBAQEBAQEBAQEBAQEBAQEBAJSMrLS0tLSslI0BAQEBAQEBAQEBAQEBAQEAqICAgICAgICAgICAgICAgICAgICBcbg0KICAgICAgICAgICAgICAgICAgICAgICA9QEBAQEBAQEBAQEBAQEBAQCUrICAgICAgICAgICAuKkBAQEBAQEBAQEBAQEBAQDogICAgICAgICAgICAgICAgICAgXG4NCiAgICAgICAgICAgICAgICAgICAgICAgICVAQEBAQEBAQEBAQEAlKzogICAgICAgICAgICAgICAuLUBAQEBAQEBAQEBAQEAqICAgICAgICAgICAgICAgICAgIFxuDQogICAgICAgICAgICAgICAgICAgICAgICAuJUBAQEBAQEBAQCo6ICAgICAgICAgICAgICAgICAgICAuK0BAQEBAQEBAQEBAQCAgICAgICAgICAgICAgICAgICBcbg0KICAgICAgICAgICAgICAgICAgICAgICAgICArQEBAQEBAQD0uICAgICAgICAgICAgICAgICAgIC4rI0BAQEBAQEBAQEBAQEAtICAgICAgICAgICAgICAgICAgXG4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgIC5AQEBAKiAgICAgICAgICAgICAgICAgICAgIC4gICAgIC46K0BAQEBAQEBAIyAgICAgICAgICAgICAgICAgIFxuDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgKkBAKyAgICAgICAgICAgICAgICAgICslQEAjLSAgIC4rLS4uJUBAQEBAQEAgICAgICAgICAgICAgICAgICBcbg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgOiVAQCAgICAgICAgICAgICAgICAgICAlQEA6ICAgICAgICNAQEBAQEBAQEBAOiAgICAgICAgICAgICAgICAgXG4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgLkBAQCUgICAgLSsqIyUjPS0gICAgICAgK0ArOj0tPSoqKypAQEA6I0BAQEBAQC0gICAgICAgICAgICAgICAgIFxuDQogICAgICAgICAgICAgICAgICAgICAgICAgICBAQEAlICAgIC4gLT0rLSAgICAgICAgICtAKis9ID0lJSUlQEAlOiAlQEBAQEA9ICAgICAgICAgICAgICAgICBcbg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgK0BAKyAgICAgICAgICAgICAgICAgICA6QEBAOiAgIC46PS06ICAgLiVAQEBAPSAgICAgICAgICAgICAgICAgXG4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgLipAQDogICAgICAgICAgICAgICAgICA6LiVAIyAgICAgICAgICAgICAtQEBAQEAqPS4gLjouICAgICAgICAgIFxuDQogICAgICAgICAgICAgICAgICAgICAgICAgIC4rQCMgICAgICAgICAgICAgIC0tICA9QCogLT0gICAgICAgICAgICAgLSVAQEBAQC4gICAgLiAgICAgICAgICBcbg0KLS09LTo6Oi4gIC4gICAgICAgICAgICAgOi0rK0ArICAgICAgICAgICAgICMlLi4lQEBAIyojICAgICAgICAgICAgLiNAQEBAQCU6Li4gICAgICAgICAgICAgXG4NCiUqKyMqKy0tOjo6LS4gLiAgIC4uListOjorKypAKyAgICAgICAgICAgICAgICAgIC1AQEBAJSAgICAgICAgICAgIC5AQEBAQEAjPSo6Li4gICAgICAgICAgIFxuDQpAQEAlJSMjKj0rPSstOjo6Li4uLi4rQEBAJSsgJSMgICAgICAgICAgIC4tIystPSAtQEBAJS4gICAgICAgICAgICAtQEBAQEBAQCstLTotKzogICAgICAgICBcbg0KQEBAQEBAJUAjIyMqKystKys9LS06Oj0rPS4uIDojICAgICAgICA9KkBAJSsgOi0gOipAQEBAKi0gICAgICAgICA9QEBAQEBAQEAlQCUtPSMjPSAgICAgICAgXG4NCkBAQEBAQEBAQCUlJSoqKis9Oi09Ki06OjouLj0uKyAgICAgIDo9LS0tLiAgICAgLi0tLi4qJUBAJSsuICAgIC4gK0BAQEBAQEBAQEAlIyUlPSAuICAgICAgIFxuDQpAQEBAQEBAQEAlJSoqKioqLS09Oi06Li4uIDojJSMgICAgICAlKyAgOisrKysrI0BAQEBAIy09KkBAQCAgICAgLUBAQEBAQEBAQCUlKys9OiAgICAgICAgOitcbg0KQEBAQEBAQCUlIyUlIz0tLS06OjouICAgICAgOkBAOiAgICAgICAgLjogICAgICAgICA6QEBAJSAqQEArICAgPUBAQEBAQEBAQEAjKz06ICAgICAgICAgLkBAXG4NCkAlJSUlIyMrKystLS0uLi4gICAgICAgICAgIDo9JS0gICAgICAgICAgICAgIC0qKyAgICAuLSAgID0jLSAgKypAQEBAQEBAIzotICAgICAgICAgICAgOiNAQFxuDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgIC09ICAgICAgICAgICAgICtAQEBAKistICAgICAuLiAgLUArQEBAQEAlIC4gICAgICAgICAgICAgLUBAQEBcbg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuIyAgICAgICAgICAgICAgK0BAQEAqLiAgICAgIC06K0AlQEBAQEBAOiAgICAgICAgICAgICAgICtAQEBAXG4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgOkA9ICArKyAgICAgICAgICArQCo6ICAgICAgOj0lQEBAQEBAQEBAOiAgICAgICAgICAgIC4jI0BAQEBAQFxuDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5AQD09JSMuICAgICAgIDo9Oi4rLiAgICAgICtAQEBAQEBAQEBALiAgICAgICAgICAgICAgJUBAQEBAQEBcbg0KPTogICAgICAgICAgICAgICAgICAgICAgICAgICAgLiVAQEBAJSMgICAgICArJUBAQCUqLSA6LSpAQEBAQEBAQEBAKiAgICAgICAgICAgICAgICtAQEBAQEBAXG4NCkBAKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgK0BAQEBAKi4gLiAqQEBAQEBAQEAjQEBAQEBAQEBAQEBAQD0gICAgICAgICAgICAgICA6QEBAQEBAQFxuDQpAQD0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICA6KyVAQEBAI0BAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEA9ICAgICAgICAgICAgICAgICVAQEBAQEBcbg0KQEAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPSpAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAPSAgICAgICAgICAgICAgICA9QEAjQEBAXG4NCkBAQCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLiNAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQCsgICAgICAgICAgICAgICAgIEBAQEBAQFxuDQpAQEAuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgOj0qQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEAjICAgICAgICAgICAgICAgICAqJStAKjpcbg0KQEAlICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC4gICAuOi0rQEBAQEBAQEBAQEBAQEBAQCAgICAgICAgICAgICAgICAgLSUuICAgXG4NCkBAKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEBAQEBAQEBAQCUqKj06KyU9ICAgICAgICAgICAgICAgICBAICAgIFxuDQpAQDogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAlQEBAQEBAKzogICAgICArQDogICAgICAgICAgICAgICAgI0ArOiBcbg0KQEAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgID0lQEAjOiAgICAgICAgPUAlPSUtICAgICAgICAgICAgID1AQEBAXG4NCkAlICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLjotICAgICAgICAgICAjKiNAQCUqKy06ICAgICAgICAuQEBAQFxuDQpAQDogICAgICAgICAgICAgICAgICAgICAgOistICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLi5AQEBAQEBAQEAjLSAgICAgICVAQEBcbg0KQEAtICAgICAgICAgICAgICAgICAgICA9JUAjICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC49QEBAQEBAQEBAQEBAJSMqKitAQEBAXG4NCkBALiAgICAgICAgICAgICAgICAuPSVAQEBAQC4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAtQEBAQEBAQEBAQEBAQEBAQEBAQEBAQFxuDQpAIyAgICAgICAgICAgIC4tKypAQEBAQEBAQEAjICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICpAQEBAQEBAQEBAQEBAQEBAQEBAQEBcbg0KQCsgICAgICA6PSsqI0BAQEBAQEBAQEBAQEBAQCsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAtQEBAQEBAQEBAQEBAQEBAQEBAQEBAXG4NCkAgLjo9KiVAQEBAQEBAQEBAQEBAQEBAQEBAQEBAPSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJUBAQEBAQEBAQEBAQEBAQEBAQEBAQFxuDQpAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEA6ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgI0BAQEBAQEBAQEBAQEBAQEBAQEBAQEBcbg0KKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgOioqKioqKioqKioqKioqKioqKioqKioqXG4NCgkJCQkJCQkJCQkJICBcbg0KVGhhbmtzIGZvciB0aGUgeWVhcnMgZ3V5cywgSSBoYXZlIGFsd2F5cyBsb29rZWQgdXAgdG8geW91LgkJCQkgIFxu";  
   const asciiFooter = "Li06Ojo6OicuLi4gICAgOjo6ICAuLC06Ojo6OiAgOjo6ICAuICAgICAuLDo6Ojo6OiAgLiwtOjo6OjovICAgLiwtOjo6OjovICAuICAgICAgICA6ICAgIDo6Oi4gICA6OjouICAgIDo6Oi4JDQo7OzsnJycnIDs7ICAgICA7OzssOzs7J2BgYGAnICA7OzsgLjs7LC4gIDs7OzsnJycnLDs7LSdgYGBgJyAgLDs7LSdgYGBgJyAgIDs7LC4gICAgOzs7ICAgOztgOzsgIGA7Ozs7LCAgYDs7OwkNCltbWywsPT1bWycgICAgIFtbW1tbWyAgICAgICAgIFtbW1tbLycgICAgIFtbY2NjYyBbW1sgICBbW1tbW1tbW1sgICBbW1tbW1svW1tbWywgLFtbW1ssICxbWyAnW1ssICBbW1tbWy4gJ1tbCQ0KYCQkJCJgYCQkICAgICAgJCQkJCQkICAgICAgICBfJCQkJCwgICAgICAgJCQiIiIiICIkJGMuICAgICIkJCIkJGMuICAgICIkJCAkJCQkJCQkJCIkJCRjJCQkY2MkJCRjICQkJCAiWSRjJCQJDQogODg4ICAgODggICAgLmQ4ODhgODhibyxfXyxvLCI4ODgiODhvLCAgICA4ODhvbyxfX2BZOGJvLCwsbzg4b2BZOGJvLCwsbzg4bzg4OCBZODgiIDg4OG84ODggICA4ODgsODg4ICAgIFk4OAkNCiAiTU0sICAgIlltbU1NTU0iIiAgIllVTU1NTU1QIk1NTSAiTU1QIiAgICIiIiJZVU1NTSBgJ1lNVVAiWU1NICBgJ1lNVVAiWU1NTU1NICBNJyAgIk1NTVlNTSAgICIiYCBNTU0gICAgIFlNCQ0KCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJDQogX19fLiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgL1wgICAgICAgICAgICBfXyAgICAgICAgICAgICAgIC5fXyAgICAgICAgICAgICAgICAgICAgICAgICAgIAkNClxfIHxfXyBfX18uX18uIC9cICAgX19fLl9fLiBfX19fICBfXyBfX19fX19fXykvIF9fX19fXyAgIF8vICB8X19fX19fX18gX18gX198ICB8IF9fXy5fXy4gICAgICAgICAgICAgICAgICAgCQ0KIHwgX18gPCAgIHwgIHwgXC8gIDwgICB8ICB8LyAgXyBcfCAgfCAgXF8gIF9fIFwvICBfX18vICAgXCAgIF9fXF8gIF9fIFwgIHwgIFwgIHw8ICAgfCAgfAkJCQkgICAJDQogfCBcX1wgXF9fXyAgfCAvXCAgIFxfX18gICggIDxfPiApICB8ICAvfCAgfCBcL1xfX18gXCAgICAgfCAgfCAgfCAgfCBcLyAgfCAgLyAgfF9cX19fICB8CQkJCSAgIAkNCiB8X19fICAvIF9fX198IFwvICAgLyBfX19ffFxfX19fL3xfX19fLyB8X198ICAvX19fXyAgPiAgICB8X198ICB8X198ICB8X19fXy98X19fXy8gX19fX3wJCQkJICAgCQ0KICAgICBcL1wvICAgICAgICAgICBcLyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXC8gICAgICAgICAgICAgICAgICAgICAgICAgICAgXC8gICAgICAgICAgICAgICAgICAgICAgICAJDQogIF9fICAuX18gICAgICAgICAgICAgX19fX19fX19fX18gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCQkJCSAgIAkNCl8vICB8X3wgIHxfXyAgIF9fX18gICBcXyAgIF9fX19fL18gX19fX19fX19fICBfX19fXyBfX19fXyAgICBfX19fIAkJCQkJICAJCQkJCSAgCQ0KXCAgIF9fXCAgfCAgXF8vIF9fIFwgICB8ICAgIF9fKXwgIHwgIFxfICBfXyBcLyAgICAgXFxfXyAgXCAgLyAgICBcICAgICAJCQkJCQkJCQkJDQogfCAgfCB8ICAgWSAgXCAgX19fLyAgIHwgICAgIFwgfCAgfCAgL3wgIHwgXC8gIFkgWSAgXC8gX18gXHwgICB8ICBcICAgICAgICAgICAgICAgICAgICAJCQkJCQkNCiB8X198IHxfX198ICAvXF9fXyAgPiAgXF9fXyAgLyB8X19fXy8gfF9ffCAgfF9ffF98ICAoX19fXyAgL19fX3wgIC8gICAgICAgIAkJCQkJCQkJCQ0KICAgICAgICAgICBcLyAgICAgXC8gICAgICAgXC8gICAgICAgICAgICAgICAgICAgICBcLyAgICAgXC8gICAgIFwvIAkJCQkJCQkJCQkJIA==";
    

/* ---------- decode and inject ascii into the page ---------- */
function decodeAndPlace(b64, targetId) {
  const txt = decodeBase64ToText(b64);
  if (!txt) {
    // if nothing, leave element empty but visible (so layout stays)
    document.getElementById(targetId).textContent = '';
    return;
  }
  document.getElementById(targetId).textContent = txt;
}

// decode initial ascii blocks (no slow-typing here)
decodeAndPlace(asciiTitle, 'ascii-title');
decodeAndPlace(asciiMiddle, 'ascii-middle');
decodeAndPlace(asciiFooter, 'ascii-footer');

/* --------------------------
   SHOPLIST & COPY LOGIC
   -------------------------- */
function makeList() {
  const fileEl = document.getElementById('shoplist');
  const outEl = document.getElementById('output');
  const maxPrice = parseInt(document.getElementById('max-price').value, 10);

  if (!fileEl.files || fileEl.files.length === 0) {
    outEl.value = 'Please select a shoplist file first.';
    return;
  }
  const file = fileEl.files[0];
  const reader = new FileReader();
  reader.onload = function(e) {
    const raw = String(e.target.result || '');
    const lines = raw.split(/\r?\n/).filter(l => l.trim().length > 0);

    const buyCommands = [];
    for (const line of lines) {
      // prefer the pipe format you used before
      if (line.indexOf('|') !== -1) {
        // example: "1| .123 | name | 500 | ...", we used parts[1] and parts[3] previously
        const parts = line.split('|').map(p => p.trim());
        // ensure parts exist
        const itemNumber = (parts[1] || '').replace(/^\.\s*/, '').trim();
        const priceCandidate = parts[3] || parts[2] || '';
        const p = parseInt(priceCandidate.replace(/[^\d-]/g, ''), 10);
        if (!isNaN(p) && p <= maxPrice) buyCommands.push(`buy ${itemNumber} (${p} gold)`);
      } else {
        // fallback: try CSV-like "item,price" or "item - price"
        const csvParts = line.split(/[,|-]/).map(p=>p.trim());
        const maybePrice = csvParts[csvParts.length-1];
        const p = parseInt(maybePrice.replace(/[^\d-]/g, ''), 10);
        const item = csvParts[0] || 'item';
        if (!isNaN(p) && p <= maxPrice) buyCommands.push(`buy ${item} (${p} gold)`);
      }
    }

    outEl.value = buyCommands.length ? buyCommands.join('; ') : 'No items under selected price found.';
  };
  reader.onerror = function() {
    outEl.value = 'Failed to read file.';
  };
  reader.readAsText(file, 'UTF-8');
}

function copyToClipboard() {
  const outEl = document.getElementById('output');
  const text = outEl.value || '';
  if (navigator.clipboard && navigator.clipboard.writeText) {
    navigator.clipboard.writeText(text).then(() => alert('Copied to clipboard!'), ()=> alert('Copy failed'));
  } else {
    // fallback
    outEl.select();
    try { document.execCommand('copy'); alert('Copied to clipboard!'); }
    catch(e) { alert('Copy failed'); }
  }
}

/* wire up buttons */
document.getElementById('btnMake').addEventListener('click', makeList);
document.getElementById('btnCopy').addEventListener('click', copyToClipboard);

/* --------------------------
   TERMINAL / THE PROFIT, WE SMART NO ORION BS! WE SMART YOU GEAR ME? BTW buy COLA, Slurpy goooooood!!
   -------------------------- */
const fakeInputEl = document.getElementById('fake-input');
let currentCmd = '';

/* helper: show secret (both print into terminal and reveal ascii-secret block) */
function revealSecret() {
  const txt = decodeBase64ToText(asciiHidden);
  if (txt) {
    printToTerminalLine(txt);
  } else {
    printToTerminalLine('(secret is empty)');
  }
}

/* small keyboard handler for the fake terminal */
document.addEventListener('keydown', (ev) => {
  // allow shortcuts to not break typing: ignore if user is focused on an input/textarea
  const active = document.activeElement;
  if (active && (active.tagName === 'INPUT' || active.tagName === 'TEXTAREA')) {
    // but still allow F2 to show secret
    if (ev.key === 'F2') {
      ev.preventDefault();
      revealSecret();
    }
    return; // don't hijack normal inputs
  }

  // F2 -> reveal secret quickly (user asked for this)
  if (ev.key === 'F2') {
    ev.preventDefault();
    revealSecret();
    return;
  }

  // basic typing into fake input
  if (ev.key === 'Backspace') {
    currentCmd = currentCmd.slice(0, -1);
    fakeInputEl.textContent = currentCmd;
    ev.preventDefault();
    return;
  }
  if (ev.key === 'Enter') {
    // handle command
    const cmd = currentCmd.trim();
    if (cmd) handleCommand(cmd);
    currentCmd = '';
    fakeInputEl.textContent = '';
    ev.preventDefault();
    return;
  }
  // printable characters
  if (ev.key.length === 1) {
    currentCmd += ev.key;
    fakeInputEl.textContent = currentCmd;
    // don't preventDefault: allow some browser combos, but it's fine to prevent in future if needed
  }
});

/* top-level command handler used by terminal and external code */
function handleCommand(raw) {
  const cmd = raw.trim();
  if (!cmd) return;
  const lower = cmd.toLowerCase();

  // glow set: "glow low" / "glow med" / "glow high"
  if (lower.startsWith('glow ')) {
    const parts = lower.split(/\s+/);
    const level = parts[1] || '';
    const term = document.querySelector('.terminal');
    term.classList.remove('low-glow','med-glow','high-glow');
    if (['low','med','high'].includes(level)) {
      term.classList.add(level + '-glow');
      printToTerminalLine(`Glow set to: ${level}`);
    } else {
      printToTerminalLine('Glow usage: glow low | glow med | glow high');
    }
    return;
  }

  switch (lower) {
    case 'help':
      printToTerminalLine('Commands: help, about, clear, secret, glow <low|med|high>');
      break;
    case 'about':
      printToTerminalLine('GG Terminal v1.0 - by Ferengi Alliance');
      break;
    case 'clear':
      document.getElementById('ascii-container').textContent = '';
      break;
    case 'secret':
      revealSecret();
      break;
    default:
      printToTerminalLine('Unknown: ' + cmd + '  (try "help")');
  }
}

/* initial prompt line (optional) */
printToTerminalLine('Welcome to GG terminal. Type "help". Press F2 to reveal hidden ASCII.');

/* If you want commands to also be callable programmatically:
   handleCommand('help'); etc.
*/

/* End of script */
</script>

</body>
</html>
